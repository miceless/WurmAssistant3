This entire feature requires a proper refactor, but I don't have time to do this. 
--Aldur